#!/usr/bin/env raku
use v6.d;

use Jupyter::Converter;

my %*SUB-MAIN-OPTS = :named-anywhere;

#-----------------------------------------------------------

#| Converts Jupyter notebooks into Markdown, HTML, and Pod6 files.
sub MAIN(Str $text,                                  #= Input file or Markdown text.
         Str :t(:format(:$to)) = 'Whatever',         #= Format to convert to. (One of 'html', 'markdown', 'pod6', or 'Whatever'.)
         Str :o(:$output) = '',                      #= Output file; if an empty string then the result is printed to stdout.
         ) {

    my $toSpec = $to;
    if !$to || $to.lc âˆˆ <whatever automatic> {
        $toSpec = do given $output {
            #when $_ ~~ / '.nb' /  { 'mathematica' }
            when $_ ~~ / '.md' /   { 'markdown' }
            when $_ ~~ / '.html' / { 'html' }
            #when $_ ~~ / '.org' / { 'org' }
            when $_ ~~ / '.pod' | '.pod6' / { 'pod6' }
            when $_ ~~ / '.raku' | '.p6' /  { 'raku' }
            default {
                note 'Cannot automatically determine the format to convert to.';
                'markdown'
            }
        }
    }

    my $res = from-jupyter($text, target => $toSpec);

    if $output.chars > 0 {
        spurt($output, $res);
    } else {
        say $res;
    }
}